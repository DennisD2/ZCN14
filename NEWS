* Changes between versions   -*- mode:text; mode:outline-minor -*-

This file (NEWS) documents the significant changes between all
versions of ZCN since 1.2, with the newest changes first.


* Changes in ZCN 1.4

Bug fixes/workarounds:

- Fixed serious NC200 format command bug. If format prompted for
  confirmation and you chose no, or if format gave a card-read-only
  error, it would leave the card mapped in memory on exit. This would
  almost guarantee memory card corruption.

- Screendumps are now not supported on NC200, due to issues along
  similar lines. This might be overly cautious, but I think it's
  probably the right move.

- Fixed corruption of a few bytes high in memory on NC200 when turned
  off and on again.

- rrxfer will now read correctly from anywhere in upper memory, even
  past 64k (this was previously broken on NC200).

- Fixed bbcmin which had been broken since day one, it wasn't copying
  some code into the right place. (This was hard to spot if you ever
  used bbcbas, which effectively masked the issue.)

- Fixed race condition on serial input buffer read/write, which could
  cause strange erroneous input. Thanks to Nils M. Holm for mentioning
  what I think was probably this bug.

- Fixed play4b's playback speed.

New features:

- NC150 support, with a custom zcn150.bin kernel. As with the NC200,
  this is not as complete as the NC100 support. Also, it has only been
  tested under emulation.

- Internal ramdisk support on NC200 and NC150, so you can use ZCN on
  them without a memory card (to some limited degree). This is really
  only intended to be used if you lack a memory card - you switch
  between memory card mode and ramdisk mode using the "ramd" command.

- Improved keyboard layout support via keyb, supporting Danish,
  French, German, Italian, Swedish, and US keyboard layouts, in
  addition to the old UK and Dvorak. All supported keyboard layouts
  can be used on any NC model.

- Preinstalled memory card images for NC100/NC150/NC200. These are
  intended for use with emulators like nc100em/MAME/RC2014, but they
  should also work on the real thing if you have the means to write
  them correctly. (Serial link installs are still supported, of
  course.)

- Support for booting from floppy disk on the NC200 - this uses David
  Given's floppy-boot code from FUZIX, almost unchanged. ZCN itself
  does not support the floppy disk, so this just loads ZCN and a small
  ramdisk image then boots it.

- Support for displaying some non-ASCII characters, specifically some
  from the old DOS code pages 437 and 850 like in the ROM software, as
  well as the euro sign character from 858. Only a few dozen
  characters are supported (!) and you need to run keyb beforehand
  (i.e. since boot) for this to work.

- NC200 time-reading and time-setting support, meaning that e.g. time
  and timeset work.

- The man command now uses ZX0 compression - the data file is smaller,
  man.com is smaller, and man pages load faster.

- Certain .com files in the support directory, like QTERM, are now
  also provided in versions using ZX0 compression. So for example, the
  ZX0-using version of QTERM is 5k smaller. ZCN comes with a
  "zx0com.bin" file you can prepend to a .zx0 file to run it in this
  way (limited to .zx0 files of 16k or less).

- Various programs are now usable (or more usable) on the NC200.

- Removed calc, dial, mft, play1b/play2b, pmarc/pmext, sokoban, VDE,
  z8e, zap, zcnbrot, and zcnclock, for what I believe were justifiable
  reasons in each case. mft, pmarc/pmext, VDE, and z8e are of course
  fairly easy to find elsewhere online.

- System blocks for booting are now always reserved on the memory
  card's A: drive at the time of formatting, simplifying sys and
  saving memory - the unsys command has been removed. This idea was
  adopted from Nils M. Holm's CP/NC fork.

- Added (Hector Peraza's) TED text editor, modified to use ZCN control
  codes. It supports editing text files larger than memory, though
  they must be pure ASCII.

- Added zcsoli, a Solitaire/Patience/Klondike card game.

- Added md5cpm, a checksum-like program compatible with "md5sum".

- Added ncspeed, which tests effective CPU speed. Average many runs
  for better accuracy, or run it once for a quick "oh, about 4.6MHz
  then". :-)

- Added nctest, which uses a few basic hardware tests to determine
  which NC model you're using, and whether or not it seems to be
  emulated.

- The rather large zcn.txt now has a small auto-generated index
  showing the section names, in index.txt.


* Changes in ZCN 1.3

Some important bug fixes:

(The first three were also fixed in zcn12fix.zip, so they probably
won't be `new' fixes to most people)

man was totally broken; it would mysteriously die without giving any
reason, which would lead to subtle crashes later on. This was due to
the most stupid thinko I think I've ever perpetrated. :-(

A less stupid, but still significant, thinko meant that only 1992 and
1996 were treated as leap years. (2000, 2004, etc. weren't.) ZCN now
has no Y2K problems (it's ok until 2099). But be sure to set the time
and date before 2004 so it has a chance to fix the old problem. :-)

Previously, if you asked rrxfer for a list of the ROM files and there
were none, it crashed (ouch!).

In the context-restore routine, the stack pointer was pointing at the
TPA at a Bad Time when restoring things, meaning that memory in the
B1F8h-B1FDh range (6 bytes) got blasted. Not the sort of bug you'd
usually notice easily, but it happened to break wade.

The context-restore rewrote 0038h-003Ah despite not needing to, which
could probably have broken wade in some (relatively unusual)
circumstances.

spellwd used to crash when run without args, when spellwd wasn't the
last command you'd run.

zcnpaint's eraser tool previously drew horizontal/vertical lines when
used right at the top/left of the screen.

And, incredibly, there's some non-bugfix stuff too... :-)

The `kernel' now assembles into two versions - the original zcn.bin
for NC100s, and a new zcn200.bin for NC200s. The NC200 version still
has some rough edges, but supports most of the hardware except for the
disk drive. Thanks to Ian Miller for helping a *lot* with testing the
NC200 support (as I don't actually have an NC200).

Added `serial' command, which allows you to disable/re-enable the
serial line driver. It's enabled by default (just as in previous
versions of ZCN), but disabling it should prolong battery life. Thanks
to Emmanuel Roussin for bringing this up.

`bigv' views a single file in much the same way as with `man's viewer.
It uses a large, proportionally-spaced font - the intent is that bigv
be comfortable to read from, especially for large texts such as online
books (`etexts'). Thanks to Steven Flintham for the inspiration behind
this.

Some minor speed optimisations in a BDOS hotspot (the crawling horror
that is `matchfcb' :-)).

`keyb' changes the keyboard map. Currently this only supports the
default UK map, and Dvorak for the UK layout. Thanks to Ian Miller for
suggesting Dvorak support.

`lfconv' converts Unix-format text files to CP/M (CR/LF) format.

VDE has replaced ZDE as the text editor included with ZCN, mainly
because it's the more widely-used version (ZDE is a VDE derivative),
and it comes with full documentation. But don't worry, your old copy
of ZDE will obviously still work if you'd prefer to stick with that.

Removed nswp from distribution.


* Changes in ZCN 1.2

Decent online help. This comes in the shape of `man', a Unix-man-like
program, and *many* man pages for it, documenting every ZCN command
and most third-party ones bundled with ZCN, taking roughly 55k for the
lot. The `help' program has been removed, as man makes it obsolete.

`zap', a graphical program-launcher.

`spell', an interactive spellchecker (which uses the ROM), a bit like
a cross between `ispell' and the ROM wp's spellchecker.

`rrinit.bin' now compensates for the ROM OS's stupid ^Z-stripping
code, which broke it in ZCN v1.1.

`cal', a calendar program like Unix `cal' - it's a Z80 port of a
public domain C program by Martin Minow.

`expr', a sort-of-clone of Unix `expr' - a Z80 port of a PD C program
by Erik Baalbergen.

Keyboard-reading code should now fully work around the bugs in the
NC100's keyboard hardware (see top of src/keyread.z for full details
of what the bugs are).

ZCN now uses IM2 by default, and can no longer be made to use IM1. So
the `useim2' command has been removed.

`setbaud' replaced with `stty'; e.g. `setbaud 7' translates to the
slightly more meaningful `stty 19200'.

New `cd -' (or `user -') command, go to last user area selected.

`note', a simple type-text-into-file internal command.

Zcnclock is now much nicer, and there's also `dclock', a new cut-down
version which fits in 1k.

`dir' now looks more like CP/M's dir.

Printer bug fixed - previously printing turned off the serial line
driver which, er, wasn't ideal. You'd never guess I hardly ever print
from ZCN, would you? :-)

Corrected serious bug in documentation. (The NC100's Z80 *DOES NOT*
run at 6MHz (it's more like 4.6MHz), even though it's a 6MHz-capable
chip! Also, ZCN isn't actually much faster than the ROM OS. It's still
better though. ;-))

Cursor move control code (^P) now uses 20h+y rather than the old (and
rather bizarre) 46h+y. 46h+y is still supported for now, but may not
be in future.

`ruler', displays a ruler onscreen.

`slide', a slide-rule emulator. Terribly useful. :-)

`calc' should now work on all ROM versions.

New `cboot' internal command cold-boots ZCN from the memory card.

New `capsctrl' internal command, swaps functions of Caps Lock and
Control keys if you do `capsctrl 1'.

New `crlf' internal command (not *another* internal command!) lets you
disable/re-enable the usual CP/M-ish line-break (CR/LF) after each
command finishes. Mainly intended for use in SUB files.

New `vdu' internal command (AIEEEE! :-)) prints one or two characters,
given their ASCII values. For example `vdu 1' clears the screen, and
`vdu 13 10' prints CR/LF.

You can now change the default LISTO setting for `bbcbas'. You have to
edit the executable, which isn't ideal, but zcn.txt demonstrates how
to do it with wade.

Some additions to zcnlib's 32-bit integer routines.

You can now change the address of the font used by ZCN. This lets
ZCN-aware programs effectively use UDGs and the like.

New `off' internal command, does what you'd expect. :-)

`bmp', a way of printing such UDGs (and bitmaps generally) from SUB
files. There's also utils/pbmtosub.c, which converts PBMs into
`bmp'-using SUB files.

ZCN checks for internal commands more quickly than it did before
(though to be fair, this was near-instant anyway :-)).

Removed the copyright message displayed when you boot ZCN. It may be a
traditional CP/M thing to have, but frankly even *I* found it slightly
irksome. Now when ZCN boots, it just displays what the `ver' command
does.

Esc as a prefix to a CR/LF now causes ZCN to ignore it. It's not clear
how useful this is, though... :-)

Fixed two .sub-related bugs. First, if a $$$.sub didn't contain a ^Z
it wasn't deleted after ZCN finished running it. Second, it assumed
(when deleting it) that $$$.sub remained in the current user, which
isn't always the case.

Fixed so things like `a:dir' (internal commands with drive specs)
don't run the internal command - now ZCN (in this case) tries to run
`dir.com' or `dir.sub' on drive A:.
